<!DOCTYPE html>
<html>
	<head>
		<style type="text/css">
			audio {
				width: 100%;
				height: 100%;
			}
		</style>
		<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
		<script type="text/javascript" src="https://golden-layout.com/files/latest/js/goldenlayout.min.js"></script>
		<link type="text/css" rel="stylesheet" href="https://golden-layout.com/files/latest/css/goldenlayout-base.css" />
		<link type="text/css" rel="stylesheet" href="https://golden-layout.com/files/latest/css/goldenlayout-dark-theme.css" />
		<style type="text/css">
		.lm_content {
			color: white;
			overflow: auto;
		}
		</style>
	</head>
	<body>
		<script type="text/javascript">
			$(document).ready(function () {
				'use strict';
				var $songList = $('#songList');
				var $audioPlayer = $('#audioPlayer');
				var songDB = {};
				var currentSong = {
					url: null
				};
				var goldenLayoutConfig = {
					settings: {
						showPopoutIcon: false,
						showCloseIcon: false,
					},
					content: [{
						type: 'column',
						content: [{
							type: 'component',
							componentName: 'mediaPlayer',
						}, {
							type: 'row',
							content: [{
								type: 'component',
								componentName: 'songList',
							},{
								type: 'component',
								componentName: 'testComponent',
							}]
						}]
					}]
				};
				var myLayout = new GoldenLayout(goldenLayoutConfig);
				myLayout.registerComponent('mediaPlayer', function(container, componentState) {
					var $video = $('<video controls autoplay preload="auto">Your browser does not support the <code>video</code> element.</video>');
					container.getElement().append($video);
					Object.observe(currentSong, function() {
						$video.attr('src', currentSong['url']);
					});
				});
				myLayout.registerComponent('songList', function(container, componentState) {
					container.getElement().html( 'Song Loading...' );
					container.getElement().on('click', 'li', function(e) {
					var $li = $(e.target);
					var url = '/api/1/songs/binary?songPath=' + encodeURIComponent($li.data('path'));
					currentSong['url'] = url;
				});
					Object.observe(songDB, function() {
						var html = '<ul>';
						for (var key in songDB) {
							html += '<li data-path="';
							html += key;
							html += '">';
							html += songDB[key];
							html += '</li>';
						}
						html += '</ul>'
						container.getElement().html(html);
					});
				});
				myLayout.registerComponent('testComponent', function(container, componentState) {
					container.getElement().html( '<h2>' + componentState.label + '</h2>' );
				});
				myLayout.init();
				$.ajax('/api/1/songs/').done(function(data, textStatus, jqXHR) {
					for (var key in data) {
						songDB[key] = key;
					}
				});
				$songList.on('click', 'li', function(e) {
					var $li = $(e.target);
					var url = '/api/1/song?songPath=' + encodeURIComponent($li.data('path'));
					console.log(url);
					$audioPlayer.attr('src', url);
				});
				
			});
		</script>
	</body>
</html>